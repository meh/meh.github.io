miniLOL.module.create("Paper",{version:"0.1",type:"active",aliases:["paper"],initialize:function(){miniLOL.CSS.include(this.root+"/resources/style.css",true)},execute:function(a){if(a.name){miniLOL.content.set("<div id='paper'>"+miniLOL.module.execute("Markdown",miniLOL.utils.get(this.root+"/papers/#{name}".interpolate(a)))+"</div>");this.content(miniLOL.theme.content());this.menu(miniLOL.theme.content());var b=miniLOL.theme.content();if(a.chapter)b=b.xpath("//a[@name = #{name}]".interpolate({name:a.chapter})).first();
b.scrollTo.delay(0.1)}},content:function(a){a.xpath("//h1[position()=1]").first().addClassName("title");a.xpath("//h2[position()=1]").first().addClassName("title");a.xpath("//h1[position()>2]").each(function(b){b.parentNode.insertBefore(new Element("hr"),b)})},menu:function(a){var b=new Element("div",{id:"paper-menu"}),e=[0,0,0,0,0,0],c;a.xpath('//h1[not(@class="title")] | //h2[not(@class="title")] | //h3 | //h4 | //h5 | //h6').each(function(d){var f=new Element("a",{name:this.toChapter(e,d.nodeName[1].toNumber())});
f.appendChild(d);d.parentNode.replaceChild(f,d);if(d.nodeName=="h1"){c&&b.appendChild(c);c=new Element("div",{"class":"main"})}f=new Element("a",{"class":d.nodeName});Event.observe(f,"click",function(){d.xpath("//a[@name = #{name}]".interpolate({name:this.firstChild.firstChild.nodeValue})).first().scrollTo()})},this);b.appendChild(c);$("paper").insert(b)},toChapter:function(a,b){for(var e="",c=0;c<b;c++)e+="."+a[c];return e.substr(1)}});
